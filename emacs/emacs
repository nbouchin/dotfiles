;;; PACKAGE-ARCHIVES --- Summary.
;;; Commentary:
(require 'package)

(add-to-list 'package-archives '("gnu" . "https://elpa.gnu.org/packages/") t)
(add-to-list 'package-archives '("melpa" . "https://melpa.milkbox.net/packages/") t)

;;; Code:
(package-initialize)

;; Install all packages.
(defun my-install ()
  "My-install searchg all packages in package-list and install them if not installed."
  (interactive)
  (defvar package-list)
  (setq package-list '(evil-leader key-chord org-evil gruvbox-theme evil rudel tabbar transpose-frame autopair git-gutter-fringe auto-complete auto-complete-c-headers auto-complete-clang magit dired-sidebar iedit helm monokai-alt-theme yasnippet-snippets yasnippet flycheck ace-jump-mode undo-tree))
  ;; fetch the list of packages available.
  (unless package-archive-contents
	(package-refresh-contents))
  ;; install the missing packages.
  (dolist (package package-list)
	(unless (package-installed-p package)
	  (package-install package)))
  )

;; Byte compile config.
(defun my-recompile ()
  "My-recompile byte-compile all configuration."
  (interactive)
  (byte-recompile-directory (expand-file-name "~/.emacs.d") 0))

(defun reload-dotemacs-file ()
  "Reload .emacs file without restarting Emacs."
  (interactive)
  (load-file "~/.emacs"))

(load-theme 'gruvbox-dark-hard t nil)

(setq-default shell-file-name "/bin/zsh"); Set default shell

(setq backup-directory-alist `(("." . "~/.emacs.d/saves"))); Set emacs swap directory.
;;(load-theme 'monokai-alt t)

(require 'dired-sidebar); Enable dired-sidebar.
(set-cursor-color "white")
(tool-bar-mode -1); Padding configuration.
(global-hl-line-mode 1)
(set-language-environment "UTF-8")
(setq ring-bell-function 'ignore)
(setq-default font-lock-global-modes t)
(setq-default tab-width 4)
(setq-default indent-tabs-mode t)
(setq-default c-backspace-function 'backward-delete-char)
(setq-default c-basic-offset 4)
(setq-default c-default-style "linux")
(setq-default tab-stop-list '(4 8 12 16 20 24 28 32 36 40 44 48 52 56 60
								64 68 72 76 80 84 88 92 96 100 104 108 112 116 120))

(load "~/.emacs.d/my-lisp/my-tabbar.el")

(require 'autopair)
(autopair-global-mode 1)
(defvar linum-format); Enable line numbers
(global-linum-mode 1)
(add-hook 'eshell-mode-hook (lambda () (linum-mode -1)))
(add-hook 'eshell-mode-hook (lambda () (global-hl-line-mode -1)))
(add-hook 'dired-mode-hook (lambda () (linum-mode -1)))
(add-hook 'dired-mode-hook (lambda () (global-hl-line-mode -1)))

(add-hook 'eshell-mode-hook
		  (defun chunyang-eshell-mode-setup ()
			(remove-hook 'eshell-output-filter-functions
						 'eshell-postoutput-scroll-to-bottom)))

(setq linum-format "%d "); Set plus bar.
(require 'git-gutter-fringe); Enable git-gutter-fringe
(global-git-gutter-mode t); Start git-gutter-fringe with emacs
(setq git-gutter-fr:side 'right-fringe); Set fringe to right
(require 'ace-jump-mode); Enable ace-jump-mode.
(define-key global-map (kbd "C-c SPC") 'ace-jump-mode)
(define-key global-map (kbd "C-c g") 'magit-status)
(define-key global-map (kbd "C-c e") 'eshell)
(define-key global-map (kbd "C-x t") 'transpose-frame)
(global-set-key (kbd "C-x d") 'dired-sidebar-toggle-sidebar)


(global-ede-mode 1); Enable ede mode

(require 'flycheck); Enable flycheck on any files.
(global-flycheck-mode)
(setq flycheck-check-syntax-automatically '(save mode-enabe))

(global-undo-tree-mode); Start undo-tree with emacs.
(setq undo-tree-auto-save-history t)
(setq undo-tree-history-directory-alist '(("." . "~/.emacs.d/undo")))

(require 'yasnippet); start yasnippet with emacs
(yas-global-mode 1)

;; Shell mode configuration
(add-hook 'shell-mode-hook
		  (lambda ()
			(face-remap-set-base 'comint-highlight-prompt :inherit nil)))

(require 'auto-complete)
(require 'auto-complete-config)

(defvar achead:include-directories)

(ac-config-default)
(setq ac-auto-show-menu t)
(defun my:ac-c-header-init ()
  "Initialize auto-complete-c-headers."
  (require 'auto-complete-c-headers)
  (add-to-list 'ac-sources 'ac-source-c-headers)
  (add-to-list 'achead:include-directories '"/usr/include")
  (add-to-list 'achead:include-directories '"/usr/include/c++/v1/")
  )
;; add c-header in hook.
(add-hook 'c++-mode-hook 'my:ac-c-header-init)
(add-hook 'c-mode-hook 'my:ac-c-header-init)

(semantic-mode 1); turn on Semantic
(defun my:add-semantic-to-autocomplete()
  "'add-to-list' into ac-sources the ac-source-semantic plugin."
  (add-to-list 'ac-sources 'ac-source-semantic)
  )
(add-hook 'c-mode-common-hook 'my:add-semantic-to-autocomplete)
(global-semantic-idle-scheduler-mode 1)

(require 'evil)
(evil-mode 1)

(global-evil-leader-mode)
(evil-leader/set-leader ";")

(evil-leader/set-key
 "n" 'evil-prev-buffer
 "p" 'evil-next-buffer
 "d" 'evil-delete-buffer
 "c" 'magit-status)

(require 'key-chord)
(key-chord-mode 1)

(key-chord-define evil-insert-state-map "kj" 'evil-normal-state)

(loop for (mode . state) in '((inferior-emacs-lisp-mode . emacs)
							  (magit-mode . normal)
							  (nrepl-mode . normal)
							  (pylookup-mode . normal)
							  (comint-mode . normal)
							  (shell-mode . normal)
							  (git-commit-mode . normal)
							  (git-rebase-mode . normal)
							  (term-mode . normal)
							  (help-mode . normal)
							  (helm-grep-mode . normal)
							  (grep-mode . normal)
							  (bc-menu-mode . normal)
							  (magit-branch-manager-mode . normal)
							  (rdictcc-buffer-mode . normal)
							  (dired-mode . normal)
							  (wdired-mode . normal))
	  do (evil-set-initial-state mode state))

(provide 'emacs)
;;; .emacs ends here
(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(custom-safe-themes
   (quote
	("e2fd81495089dc09d14a88f29dfdff7645f213e2c03650ac2dd275de52a513de" default)))
 '(package-selected-packages
   (quote
	(org-evil gruvbox-theme evil markdown-mode evil-visual-mark-mode tabbar transpose-frame rudel monokai-alt autopair git-gutter-fringe auto-complete-clang auto-complete-c-headers magit dired-sidebar auto-complete iedit yasnippet-snippets yasnippet flycheck))))
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 )
